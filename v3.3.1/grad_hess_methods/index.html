<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Gradient and Hessian Methods · PEtab.jl</title><meta name="title" content="Gradient and Hessian Methods · PEtab.jl"/><meta property="og:title" content="Gradient and Hessian Methods · PEtab.jl"/><meta property="twitter:title" content="Gradient and Hessian Methods · PEtab.jl"/><meta name="description" content="Documentation for PEtab.jl."/><meta property="og:description" content="Documentation for PEtab.jl."/><meta property="twitter:description" content="Documentation for PEtab.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/custom_theme.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PEtab.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Extended Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../petab_simcond/">Simulation conditions</a></li><li><a class="tocitem" href="../petab_preeq_simulations/">Steady-State Simulations (Pre-Equilibration)</a></li><li><a class="tocitem" href="../petab_event/">Events (callbacks, dosages, etc.)</a></li><li><a class="tocitem" href="../petab_cond_specific/">Simulation Condition-Specific Parameters</a></li><li><a class="tocitem" href="../petab_obs_noise/">Noise and Observable Parameters</a></li><li><a class="tocitem" href="../import_petab/">Importing PEtab Standard Format</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Parameter Estimation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../pest_method/">Parameter Estimation Methods</a></li><li><a class="tocitem" href="../pest_plot/">Plotting Estimation Results</a></li><li><a class="tocitem" href="../pest_algs/">Available and Recommended Algorithms</a></li><li><a class="tocitem" href="../pest_select/">Model Selection with PEtab-select</a></li><li><a class="tocitem" href="../pest_custom/">Wrapping Optimization Packages</a></li></ul></li><li><a class="tocitem" href="../inference/">Bayesian Inference</a></li><li><a class="tocitem" href="../API/">API</a></li><li class="is-active"><a class="tocitem" href>Gradient and Hessian Methods</a><ul class="internal"><li><a class="tocitem" href="#Gradient-Methods"><span>Gradient Methods</span></a></li><li><a class="tocitem" href="#Hessian-Methods"><span>Hessian Methods</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../default_options/">Default Options</a></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">Performance Tips</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../nonstiff_models/">Non-Biology (Non-Stiff) Models</a></li><li><a class="tocitem" href="../Beer/">Condition-Specific Parameters</a></li><li><a class="tocitem" href="../Bachmann/">Adjoint Sensitivity Analysis (Large Models)</a></li></ul></li><li><a class="tocitem" href="../references/">References</a></li><li><a class="tocitem" href="../FAQ/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Gradient and Hessian Methods</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Gradient and Hessian Methods</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sebapersson/PEtab.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/sebapersson/PEtab.jl/blob/main/docs/src/grad_hess_methods.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="gradient_support"><a class="docs-heading-anchor" href="#gradient_support">Gradient and Hessian Methods</a><a id="gradient_support-1"></a><a class="docs-heading-anchor-permalink" href="#gradient_support" title="Permalink"></a></h1><p>PEtab.jl supports several gradient and Hessian computation methods when creating a <code>PEtabODEProblem</code>. This section provides a brief overview of each available method and the corresponding tunable options.</p><h2 id="Gradient-Methods"><a class="docs-heading-anchor" href="#Gradient-Methods">Gradient Methods</a><a id="Gradient-Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Gradient-Methods" title="Permalink"></a></h2><p>PEtab.jl supports three gradient computation methods: forward-mode automatic differentiation (<code>:ForwardDiff</code>), forward-sensitivity equations (<code>:ForwardEquations</code>), and adjoint sensitivity analysis (<code>:Adjoint</code>). A good introduction to the math behind these methods can be found in [<a href="../references/#sapienza2024differentiable">16</a>], and a good introduction to automatic differentitation can be found in [<a href="../references/#blondel2024elements">17</a>]. Below is a brief description of each method.</p><ul><li><code>:ForwardDiff</code>: This method uses <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a> to compute the gradient via forward-mode automatic differentiation [<a href="../references/#revels2016forward">18</a>]. The only tunable option is the <code>chunksize</code> (the number of directional derivatives computed in a single forward pass). While the default <code>chunksize</code> is typically a good choice, performance can be slightly improved by tuning this parameter, and we plan to add automatic tuning. This method is often the fastest for smaller models [<a href="../references/#mester2022differential">19</a>].</li><li><code>:ForwardEquations</code>: This method computes the gradient by solving an expanded ODE system to obtain the forward sensitivities during the forward pass. These sensitivities are then used to compute the gradient. The tunable option is <code>sensealg</code>, where the default option <code>sensealg=:ForwardDiff</code> (compute the sensitivities via forward-mode automatic differentiation) is often the fastest. PEtab.jl also supports the <code>ForwardSensitivity()</code> and <code>ForwardDiffSensitivity()</code> methods from <a href="https://github.com/SciML/SciMLSensitivity.jl">SciMLSensitivity.jl</a>. For more details and tunable options for these two methods, see the SciMLSensitivity <a href="https://github.com/SciML/SciMLSensitivity.jl">documentation</a>.</li><li><code>:Adjoint</code>: This method computes the gradient via adjoint sensitivity analysis, which involves solving an adjoint ODE backward in time. Several benchmark studies have shown that the adjoint method is the most efficient for larger models [<a href="../references/#frohlich2017scalable">20</a>, <a href="../references/#ma2021comparison">21</a>]. The tunable option is <code>sensealg</code>, which specifies the adjoint algorithm from SciMLSensitivity to use. Available algorithms are <code>InterpolatingAdjoint</code>, <code>GaussAdjoint</code>, and <code>QuadratureAdjoint</code>. For information on their tunable options, see the SciMLSensitivity <a href="https://github.com/SciML/SciMLSensitivity.jl">documentation</a>.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>To use functionality from SciMLSensitivity (e.g., adjoint sensitivity analysis), the package must be loaded with <code>using SciMLSensitivity</code> before creating the <code>PEtabODEProblem</code>.</p></div></div><h2 id="Hessian-Methods"><a class="docs-heading-anchor" href="#Hessian-Methods">Hessian Methods</a><a id="Hessian-Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Hessian-Methods" title="Permalink"></a></h2><p>PEtab.jl supports three Hessian computation methods: forward-mode automatic differentiation (<code>:ForwardDiff</code>), a block Hessian approximation (<code>:BlockForwardDiff</code>), and the Gauss-Newton Hessian approximation (<code>:GaussNewton</code>). Below is a brief description of each method.</p><p><code>:ForwardDiff</code>: Thsi method computes the Hessian via forward-mode automatic differentiation using <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>. As with the gradient, the only tunable option is the <code>chunksize</code>. This method has quadratic complexity, <span>$O(n^2)$</span>, where <span>$n$</span> is the number of parameters, making it feasible only for models with up to <span>$n = 20$</span> parameters. However, when computationally feasible, access to the full Hessian can improve the convergence of parameter estimation runs when doing multi-start parameter estimation.</p><ul><li><code>:BlockForwardDiff</code>: This method computes a block Hessian approximation using forward-mode automatic differentiation with <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>. Specifically, for PEtab problems, there are typically two sets of parameters to estimate: the parameters that are part of the ODE system, <span>$\\mathbf{x}_p$</span>, and those that are not, <span>$\\mathbf{x}_q$</span>. This block approach computes the Hessian for each block while approximating the cross-terms as zero:</li></ul><p class="math-container">\[\mathbf{H}_{block} =
\begin{bmatrix}
\mathbf{H}_{p} &amp; \mathbf{0} \\
\mathbf{0} &amp; \mathbf{H}_q
\end{bmatrix}\]</p><ul><li><code>:GaussNewton</code>: This method approximates the Hessian using the <a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Newton_algorithm">Gauss-Newton</a> method. This method often performs better than a (L)-BFGS approximation [<a href="../references/#frohlich2017scalable">20</a>], but requires access to forward sensitivities (similar to <code>:ForwardEquations</code> above), and computing these for models with more than 75 parameters is often not computationally feasible. For more details on the computations see [<a href="../references/#raue2015data2dynamics">22</a>]. Therefore, for larger models, a (L)-BFGS approximation is often the only feasible option.</li></ul><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><div class="citation noncanonical"><dl><dt>[16]</dt><dd><div>F. Sapienza, J. Bolibar, F. Schäfer, B. Groenke, A. Pal, V. Boussange, P. Heimbach, G. Hooker, F. Pérez, P.-O. Persson and others. <em>Differentiable Programming for Differential Equations: A Review</em>, arXiv preprint arXiv:2406.09699 (2024).</div></dd><dt>[17]</dt><dd><div>M. Blondel and V. Roulet. <em>The elements of differentiable programming</em>, arXiv preprint arXiv:2403.14606 (2024).</div></dd><dt>[18]</dt><dd><div>J. Revels, M. Lubin and T. Papamarkou. <em>Forward-mode automatic differentiation in Julia</em>, arXiv preprint arXiv:1607.07892 (2016).</div></dd><dt>[19]</dt><dd><div>R. Mester, A. Landeros, C. Rackauckas and K. Lange. <em>Differential methods for assessing sensitivity in biological models</em>. PLoS computational biology <strong>18</strong>, e1009598 (2022).</div></dd><dt>[20]</dt><dd><div>F. Fröhlich, B. Kaltenbacher, F. J. Theis and J. Hasenauer. <em>Scalable parameter estimation for genome-scale biochemical reaction networks</em>. PLoS computational biology <strong>13</strong>, e1005331 (2017).</div></dd><dt>[21]</dt><dd><div>Y. Ma, V. Dixit, M. J. Innes, X. Guo and C. Rackauckas. <em>A comparison of automatic differentiation and continuous sensitivity analysis for derivatives of differential equation solutions</em>. In: <em>2021 IEEE High Performance Extreme Computing Conference (HPEC)</em> (IEEE, 2021); pp. 1–9.</div></dd><dt>[22]</dt><dd><div>A. Raue, B. Steiert, M. Schelker, C. Kreutz, T. Maiwald, H. Hass, J. Vanlier, C. Tönsing, L. Adlung, R. Engesser and others. <em>Data2Dynamics: a modeling environment tailored to parameter estimation in dynamical systems</em>. Bioinformatics <strong>31</strong>, 3558–3560 (2015).</div></dd></dl></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../API/">« API</a><a class="docs-footer-nextpage" href="../default_options/">Default Options »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Sunday 27 October 2024 12:51">Sunday 27 October 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
