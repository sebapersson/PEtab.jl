<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Default Options · PEtab.jl</title><meta name="title" content="Default Options · PEtab.jl"/><meta property="og:title" content="Default Options · PEtab.jl"/><meta property="twitter:title" content="Default Options · PEtab.jl"/><meta name="description" content="Documentation for PEtab.jl."/><meta property="og:description" content="Documentation for PEtab.jl."/><meta property="twitter:description" content="Documentation for PEtab.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/custom_theme.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PEtab.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Extended Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../petab_simcond/">Simulation conditions</a></li><li><a class="tocitem" href="../petab_preeq_simulations/">Steady-State Simulations (Pre-Equilibration)</a></li><li><a class="tocitem" href="../petab_event/">Events (callbacks, dosages, etc.)</a></li><li><a class="tocitem" href="../petab_cond_specific/">Simulation Condition-Specific Parameters</a></li><li><a class="tocitem" href="../petab_obs_noise/">Noise and Observable Parameters</a></li><li><a class="tocitem" href="../import_petab/">Importing PEtab Standard Format</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Parameter Estimation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../pest_method/">Parameter Estimation Methods</a></li><li><a class="tocitem" href="../pest_plot/">Plotting Estimation Results</a></li><li><a class="tocitem" href="../pest_algs/">Available and Recommended Algorithms</a></li><li><a class="tocitem" href="../pest_select/">Model Selection with PEtab-select</a></li><li><a class="tocitem" href="../pest_custom/">Wrapping Optimization Packages</a></li></ul></li><li><a class="tocitem" href="../inference/">Bayesian Inference</a></li><li><a class="tocitem" href="../API/">API</a></li><li><a class="tocitem" href="../grad_hess_methods/">Gradient and Hessian Methods</a></li><li class="is-active"><a class="tocitem" href>Default Options</a><ul class="internal"><li><a class="tocitem" href="#Small-Models-(\\leq-20-Parameters-and-\\leq-15-ODEs)"><span>Small Models (<span>$\leq 20$</span> Parameters and <span>$\leq 15$</span> ODEs)</span></a></li><li><a class="tocitem" href="#Medium-Sized-Models-(\\leq-75-Parameters-and-\\leq-75-ODEs)"><span>Medium-Sized Models (<span>$\leq 75$</span> Parameters and <span>$\leq 75$</span> ODEs)</span></a></li><li><a class="tocitem" href="#Large-Models-(\\geq-75-Parameters-and-\\geq-75-ODEs)"><span>Large Models (<span>$\geq 75$</span> Parameters and <span>$\geq 75$</span> ODEs)</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">Performance Tips</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../nonstiff_models/">Non-Biology (Non-Stiff) Models</a></li><li><a class="tocitem" href="../Beer/">Condition-Specific Parameters</a></li><li><a class="tocitem" href="../Bachmann/">Adjoint Sensitivity Analysis (Large Models)</a></li></ul></li><li><a class="tocitem" href="../references/">References</a></li><li><a class="tocitem" href="../FAQ/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Default Options</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Default Options</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sebapersson/PEtab.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/sebapersson/PEtab.jl/blob/main/docs/src/default_options.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="default_options"><a class="docs-heading-anchor" href="#default_options">Default Options</a><a id="default_options-1"></a><a class="docs-heading-anchor-permalink" href="#default_options" title="Permalink"></a></h1><p>PEtab.jl supports several gradient and Hessian computation methods, as well as the ODE solvers available in <a href="https://github.com/SciML/OrdinaryDiffEq.jl">OrdinaryDiffEq.jl</a>. As a result, there are many possible choices when creating a <code>PEtabODEProblem</code>. To simplify usage, PEtab.jl has benchmark derived heuristics to select appropriate default options based on the size of the parameter estimation problem. This page discusses these default options when creating a <code>PEtabODEProblem</code>.</p><p>The default options are based on model size, which is determined by the number of ODEs and the number of parameters to estimate. This is because there is typically no &quot;one-size-fits-all&quot; solution: ODE solvers that perform well for small models may not perform well for large models, and gradient methods that are effective for small models may not be suitable for larger ones. It should also be noted that the defaults are based on benchmarks for stiff biological models. For information on how to configure the <code>PEtabODEProblem</code> for models outside of biology, see <a href="../nonstiff_models/#nonstiff_models">this</a> page.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>These defaults often work well, but they may not be optimal for every model as each problem is unique.</p></div></div><h2 id="Small-Models-(\\leq-20-Parameters-and-\\leq-15-ODEs)"><a class="docs-heading-anchor" href="#Small-Models-(\\leq-20-Parameters-and-\\leq-15-ODEs)">Small Models (<span>$\leq 20$</span> Parameters and <span>$\leq 15$</span> ODEs)</a><a id="Small-Models-(\\leq-20-Parameters-and-\\leq-15-ODEs)-1"></a><a class="docs-heading-anchor-permalink" href="#Small-Models-(\\leq-20-Parameters-and-\\leq-15-ODEs)" title="Permalink"></a></h2><p><strong>ODE solver</strong>: For small stiff models, the Rosenbrock <code>Rodas5P()</code> solver is typically the fastest and most accurate. While Julia&#39;s BDF solvers like <code>QNDF()</code> can perform well, they tend to be less reliable and accurate compared to <code>Rodas5P()</code> in this regime.</p><p><strong>Gradient method</strong>: For small models, forward-mode automatic differentiation via <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a> is usually the fastest method, often being twice as fast as the forward-sensitivity equations approach. For <code>:ForwardDiff</code>, it is possible to set the <a href="https://juliadiff.org/ForwardDiff.jl/stable/">chunk size</a>, which can improve performance. However, determining the optimal value can be challenging, and thus we plan to add automatic tuning.</p><p><strong>Hessian method</strong>: For small models, computing the full Hessian via <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a> is often computationally feasible. Benchmarks have shown that using the full Hessian improves convergence.</p><p>Overall, for small models, the default configuration is:</p><pre><code class="language-julia hljs">petab_prob = PEtabODEProblem(model; odesolver=ODESolver(Rodas5P()),
                             gradient_method=:ForwardDiff, 
                             hessian_method=:ForwardDiff)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If a model has many condition-specific parameters that only appear in a subset of simulation conditions (see <a href="../petab_cond_specific/#define_conditions">this</a> tutorial), runtime can be improved by setting <code>split_over_conditions=true</code> in the <code>PEtabODEProblem</code>. For more details, see [this] example.</p></div></div><h2 id="Medium-Sized-Models-(\\leq-75-Parameters-and-\\leq-75-ODEs)"><a class="docs-heading-anchor" href="#Medium-Sized-Models-(\\leq-75-Parameters-and-\\leq-75-ODEs)">Medium-Sized Models (<span>$\leq 75$</span> Parameters and <span>$\leq 75$</span> ODEs)</a><a id="Medium-Sized-Models-(\\leq-75-Parameters-and-\\leq-75-ODEs)-1"></a><a class="docs-heading-anchor-permalink" href="#Medium-Sized-Models-(\\leq-75-Parameters-and-\\leq-75-ODEs)" title="Permalink"></a></h2><p><strong>ODE solver</strong>: For medium-sized stiff models, multi-step BDF solvers like <code>QNDF()</code> are generally fast and accurate [<a href="../references/#stadter2021benchmarking">23</a>]. However, they can fail for models with many events when using low tolerances. In such cases, <code>KenCarp4()</code> is a reliable alternative.</p><p><strong>Gradient method</strong>: As with small models, the most efficient gradient method for medium-sized models is forward-mode automatic differentiation via <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>.</p><p><strong>Hessian method</strong>: For medium-sized models, computing the full Hessian via <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a> is often computationally infeasible. Instead, we recommend the Gauss-Newton Hessian approximation, which in behcmarks frequently outperforms the commonly used (L)-BFGS approximation [<a href="../references/#frohlich2022fides">1</a>].</p><p>Overall, for medium models, the default configuration is:</p><pre><code class="language-julia hljs">petab_prob = PEtabODEProblem(model; odesolver=ODESolver(QNDF(), abstol=1e-8, reltol=1e-8),
                             gradient_method=:ForwardDiff, 
                             hessian_method=:GaussNewton)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If an optimization algorithm computes both the gradient and Hessian simultaneously, and the Hessian is computed using the Gauss-Newton approximation, it is possible to reuse quantities from gradient computations by setting <code>gradient_method = :ForwardEquations</code> and <code>reuse_sensitivities = true</code>. For more information, see <a href="../pest_algs/#options_optimizers">this</a> page on the Fides optimizer.</p></div></div><h2 id="Large-Models-(\\geq-75-Parameters-and-\\geq-75-ODEs)"><a class="docs-heading-anchor" href="#Large-Models-(\\geq-75-Parameters-and-\\geq-75-ODEs)">Large Models (<span>$\geq 75$</span> Parameters and <span>$\geq 75$</span> ODEs)</a><a id="Large-Models-(\\geq-75-Parameters-and-\\geq-75-ODEs)-1"></a><a class="docs-heading-anchor-permalink" href="#Large-Models-(\\geq-75-Parameters-and-\\geq-75-ODEs)" title="Permalink"></a></h2><p>While PEtab.jl provides default settings for large models, we recommend benchmarking different methods. This is because selecting the best ODE solver and gradient configuration can substantially impact runtime.</p><p><strong>ODE solver</strong>: For efficiently simulating large models, we recommend benchmarking various ODE solvers designed for large problems, such as <code>QNDF()</code>, <code>FBDF()</code>, <code>KenCarp4()</code>, and <code>CVODE_BDF()</code>. Further, we recommend trying a sparse Jacobian (<code>sparse_jacobian = true</code>) and testing different linear solvers, such as <code>CVODE_BDF(linsolve=:KLU)</code>. For more information on solving large stiff models in Julia, see <a href="https://docs.sciml.ai/DiffEqDocs/stable/tutorials/advanced_ode_example/">this</a> tutorial.</p><p><strong>Gradient method</strong>: For large models, the most efficient gradient method is adjoint sensitivity analysis (<code>gradient_method=:Adjoint</code>). PEtab.jl supports the <code>InterpolatingAdjoint()</code>, <code>GaussAdjoint()</code>, and <code>QuadratureAdjoint()</code> algorithms from SciMLSensitivity.jl. The default is <code>InterpolatingAdjoint(autojacvec = EnzymeVJP())</code>, but we strongly recommend benchmarking different adjoint methods and different <code>autojacvec</code> options. For further details on adjoint options, see the SciMLSensitivity.jl <a href="https://docs.sciml.ai/SciMLSensitivity/stable/">documentation</a>.</p><p><strong>Hessian method</strong>: For large models, computing sensitivities (Gauss-Newton) or a full Hessian is not computationally feasible. Therefore, using an L-(BFGS) approximation is often the best option. BFGS support is built into most available optimizers such as <a href="https://github.com/JuliaNLSolvers/Optim.jl">Optim.jl</a>, <a href="https://github.com/jump-dev/Ipopt.jl">Ipopt.jl</a>, and <a href="https://github.com/fides-dev/fides">Fides.py</a>.</p><p>Overall, for large models, the default configuration is:</p><pre><code class="language-julia hljs">petab_prob = PEtabODEProblem(model, odesolver=ODESolver(CVODE_BDF()),
                             gradient_method=:Adjoint,
                             sensealg=InterpolatingAdjoint(autojacvec=EnzymeVJP()))</code></pre><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><div class="citation noncanonical"><dl><dt>[1]</dt><dd><div>F. Fröhlich and P. K. Sorger. <em>Fides: Reliable trust-region optimization for parameter estimation of ordinary differential equation models</em>. PLoS computational biology <strong>18</strong>, e1010322 (2022).</div></dd><dt>[23]</dt><dd><div>P. Städter, Y. Schälte, L. Schmiester, J. Hasenauer and P. L. Stapor. <em>Benchmarking of numerical integration methods for ODE models of biological systems</em>. Scientific reports <strong>11</strong>, 2696 (2021).</div></dd></dl></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../grad_hess_methods/">« Gradient and Hessian Methods</a><a class="docs-footer-nextpage" href="../nonstiff_models/">Non-Biology (Non-Stiff) Models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Wednesday 2 October 2024 14:43">Wednesday 2 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
